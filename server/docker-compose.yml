version: "3.8"

services:
  mattstash-api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mattstash-api
    environment:
      - MATTSTASH_DB_PATH=/data/mattstash.kdbx
      - MATTSTASH_API_KEYS_FILE=/secrets/api_keys.txt
      - KDBX_PASSWORD_FILE=/secrets/kdbx_password.txt
      - MATTSTASH_LOG_LEVEL=info
    volumes:
      - ./data:/data:ro
      - ./secrets:/secrets:ro
    networks:
      - internal
    ports:
      - "127.0.0.1:8000:8000"  # Only localhost by default
    restart: unless-stopped
    
  # Example client service showing how to connect
  # Uncomment and modify as needed
  # my-app:
  #   image: myapp:latest
  #   environment:
  #     - MATTSTASH_API_URL=http://mattstash-api:8000
  #     - MATTSTASH_API_KEY=${MY_APP_API_KEY}
  #   networks:
  #     - internal
  #   depends_on:
  #     - mattstash-api

networks:
  internal:
    driver: bridge
